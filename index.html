<!DOCTYPE html><html lang="zh-TW"><head><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
     <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>貓貓專屬迷你占卜</title>
     
    <link rel="icon" href="icons/icon-192x192.png" sizes="192x192" type="image/png">
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    <!-- 添加可愛的字體 - 確保字體完全加載 -->
    <link href="https://fonts.googleapis.com/css2?family=Hachi+Maru+Pop&family=Kosugi+Maru&family=Baloo+2:wght@600;700&display=swap" rel="stylesheet" crossorigin="anonymous" media="all">
    
    <!-- 專用於Chrome的PWA支持 -->
    <!-- 默認favicon（使用base64編碼的小PNG圖標） -->
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEJQTFRFAFz/AV3/Al7/A1//BGD/BWH/Dl//D2D/EGD/SXz/Sn3/kK7/ka//z9f/0Nj/0dn/4uf/4+j/8vX/8/X/9fb//f3//v7/bIBJkQAAACZ0Uk5TAAECBQcNDxUfICQmJy0uNTo7PUBBTE5YXWNveYqTpqu1yM7c7fb95XPJAAAAt0lEQVR42q2TSQ6DMBAEG4JZbMj+/P8nUQAplsm4hLpstyVXOTbqbZYgtlnfk8iwi+QcuZAEsiF7PGCD7J2SJwxIguRNvkwEgkmU3JYkEUwSSw5sNB1MYqJkCaArmCTNDmw0XThJZpLlgXZy4Gvx7JLcPBtfEhBsKBIbPkFRtKBOFFf2q1ApIoCqaKPdLPr5dPFt4nnJtOFxzb7jdc1OwvOaXcnjP3DW4PTkd8cP8meAn+NTGADR/RXVyPYnZAAAAABJRU5ErkJggg==">
    
    <!-- Chrome/Android專用Web App Manifest (直接使用data URI) -->
    <link rel="manifest" href="data:application/manifest+json;base64,ewogICJuYW1lIjogIuiyswSEKzYWzi6LKzYWwgNpPrDosrs+NUw6L+U5Y23mn4/lj6MiLAogICJzaG9ydF9uYW1lIjogIuiyswSEKzYWwgOnj+WPoyIsCiAgImRlc2NyaXB0aW9uIjogIua0u+WJjeWfteW+l+S+huiysyEiLAogICJzdGFydF91cmwiOiAiLiIsCiAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgIm9yaWVudGF0aW9uIjogInBvcnRyYWl0IiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZmZmZmZmIiwKICAidGhlbWVfY29sb3IiOiAiIzVENUNERSIsCiAgImdjbV9zZW5kZXJfaWQiOiAiIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9pLmltZ3VyLmNvbS91NFVkc0N5LmpwZWciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL2pwZWciLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9LAogICAgewogICAgICAic3JjIjogImh0dHBzOi8vaS5pbWd1ci5jb20vdTRVZHNDeS5qcGVnIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9qcGVnIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQo=">
    
    <!-- Chrome Web App特定元數據 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="貓貓占卜">
    
    <!-- 為Chrome設置主題色 -->
    <meta name="theme-color" content="#5D5CDE">
    
    <!-- iOS特有標籤 -->
    <link rel="apple-touch-icon" href="https://i.imgur.com/u4UdsCy.jpeg">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="貓貓占卜">
    
    <!-- 兼容舊版本浏覽器 -->
    <link rel="shortcut icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEJQTFRFAFz/AV3/Al7/A1//BGD/BWH/Dl//D2D/EGD/SXz/Sn3/kK7/ka//z9f/0Nj/0dn/4uf/4+j/8vX/8/X/9fb//f3//v7/bIBJkQAAACZ0Uk5TAAECBQcNDxUfICQmJy0uNTo7PUBBTE5YXWNveYqTpqu1yM7c7fb95XPJAAAAt0lEQVR42q2TSQ6DMBAEG4JZbMj+/P8nUQAplsm4hLpstyVXOTbqbZYgtlnfk8iwi+QcuZAEsiF7PGCD7J2SJwxIguRNvkwEgkmU3JYkEUwSSw5sNB1MYqJkCaArmCTNDmw0XThJZpLlgXZy4Gvx7JLcPBtfEhBsKBIbPkFRtKBOFFf2q1ApIoCqaKPdLPr5dPFt4nnJtOFxzb7jdc1OwvOaXcnjP3DW4PTkd8cP8meAn+NTGADR/RXVyPYnZAAAAABJRU5ErkJggg==" type="image/png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                        'primary-light': '#7a79e3'
                    }
                }
            }
        }
    </script>
    <style>
        :root {
            --app-scale: 1;
        }
        
        /* 背景图片设置 */
        body {
            background-image: url('https://i.imgur.com/Q5NDOF7.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        /* 添加半透明覆盖层，使前景内容更易读 */
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.7);
            z-index: -1;
        }
        
        /* 模態窗口樣式 */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-container {
            background-color: white;
            padding: calc(1.5rem * var(--app-scale));
            border-radius: 12px;
            width: 90%;
            max-width: calc(500px * var(--app-scale));
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }
        
        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: calc(1rem * var(--app-scale));
            border-bottom: 1px solid #eee;
            padding-bottom: calc(0.75rem * var(--app-scale));
        }
        
        .modal-title {
            font-size: calc(1.5rem * var(--app-scale));
            font-weight: bold;
            color: #333;
        }
        
        .modal-close {
            font-size: calc(1.5rem * var(--app-scale));
            background: none;
            border: none;
            cursor: pointer;
            color: #666;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        /* 返回按鈕樣式 - 放在右邊 */
        .back-button {
            display: inline-flex;
            align-items: center;
            padding: calc(0.5rem * var(--app-scale)) calc(1rem * var(--app-scale));
            background-color: #f0f0f0;
            border: none;
            border-radius: 8px;
            font-size: calc(1rem * var(--app-scale));
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-top: calc(1rem * var(--app-scale));
            float: right; /* 放在右邊 */
        }
        
        .back-button:hover {
            background-color: #e0e0e0;
        }
        
        .back-button-icon {
            margin-right: calc(0.5rem * var(--app-scale));
        }
        
        /* 郵箱列表和內容區域 */
        .mail-view, .mail-detail-view {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        
        .mail-view.hidden, .mail-detail-view.hidden {
            display: none;
            opacity: 0;
            transform: translateY(20px);
        }
        
        .mail-view, .mail-detail-view:not(.hidden) {
            opacity: 1;
            transform: translateY(0);
        }
        
        .mail-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .mail-item {
            padding: calc(0.75rem * var(--app-scale));
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: calc(0.75rem * var(--app-scale));
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
        }
        
        .mail-item:hover {
            background-color: #f5f5f5;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        
        .mail-item.active {
            border-color: #90CAF9;
            background-color: #E3F2FD;
        }
        
        .mail-icon {
            margin-right: calc(0.75rem * var(--app-scale));
            font-size: calc(1.25rem * var(--app-scale));
            color: #FF6B6B;
        }
        
        .mail-title {
            font-weight: 500;
        }
        
        .mail-content {
            padding: calc(1.5rem * var(--app-scale));
            line-height: 1.6;
            background-color: #f9f9f9;
            border-radius: 8px;
            min-height: calc(150px * var(--app-scale));
            white-space: pre-line;
        }
        
        /* 郵箱詳細頁面的標題 */
        .mail-detail-title {
            font-size: calc(1.25rem * var(--app-scale));
            font-weight: bold;
            margin-bottom: calc(1rem * var(--app-scale));
            color: #333;
            padding-bottom: calc(0.5rem * var(--app-scale));
            border-bottom: 1px solid #eee;
        }
        
        /* 整體容器設置為視口高度，避免滾動 */
        .app-container {
            min-height: 100vh;
            max-height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-sizing: border-box;
            padding: 1rem;
        }
        
        /* 根據不同屏幕高度設置縮放比例 - 更精細的梯度 */
        /* 桌面版採用更大尺寸 */
        @media (min-width: 768px) and (min-height: 800px) {
            :root {
                --app-scale: 1.3;
            }
        }
        
        @media (min-width: 992px) and (min-height: 900px) {
            :root {
                --app-scale: 1.5;
            }
        }
        
        @media (min-width: 1200px) and (min-height: 900px) {
            :root {
                --app-scale: 1.7;
            }
        }
        
        /* 小屏幕縮放梯度 */
        @media (max-height: 800px) {
            :root {
                --app-scale: 0.95;
            }
        }
        
        @media (max-height: 700px) {
            :root {
                --app-scale: 0.85;
            }
        }
        
        @media (max-height: 600px) {
            :root {
                --app-scale: 0.75;
            }
        }
        
        @media (max-height: 500px) {
            :root {
                --app-scale: 0.65;
            }
        }
        
        @media (max-height: 400px) {
            :root {
                --app-scale: 0.55;
            }
        }
        
        /* 標題縮放和可愛字體 - 移除粗體 */
        .app-title {
            font-size: calc(1.875rem * var(--app-scale));
            margin-bottom: calc(0.5rem * var(--app-scale));
            font-family: 'Baloo 2', cursive !important;
            font-weight: 400; /* 移除粗體 */
            letter-spacing: 0.03em;
            /* 確保字體加載前有適當的備用選項 */
            font-display: swap;
        }
        
        /* 共享按钮样式 - 为郵箱和签到框设置共同的样式 */
        .button-common {
            position: absolute;
            left: calc(1rem * var(--app-scale));
            border-radius: 12px;
            padding: calc(0.8rem * var(--app-scale)) calc(1.2rem * var(--app-scale));
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            width: calc(8.5rem * var(--app-scale)); /* 增加宽度，避免两行显示 */
            white-space: nowrap; /* 防止文本换行 */
            font-size: calc(1.1rem * var(--app-scale)); /* 调整字体大小为1.1rem */
            font-weight: 500;
        }
        
        /* 郵箱箱樣式 */
        .mailbox {
            top: calc(5rem * var(--app-scale)); /* 再提高3rem位置到5rem */
            background-color: #E3F2FD; /* 淺藍色底色 */
            color: #333333;
            transition: all 0.3s ease;
            border: 2px solid #90CAF9;
            cursor: pointer;
        }
        
        .mailbox:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
            background-color: #BBDEFB;
        }
        
        .mailbox-icon {
            margin-right: calc(0.6rem * var(--app-scale));
            font-size: calc(1.2rem * var(--app-scale));
        }
        
        /* 簽到計數器樣式 - 與郵箱框保持一致寬度 */
        .checkin-counter {
            top: calc(9rem * var(--app-scale)); /* 再提高3rem位置到9rem，保持4rem间距 */
            background-color: #FFF8E1; /* 淺黃色底色 */
            color: #333333; /* 改為黑色 */
            transition: all 0.5s cubic-bezier(0.18, 0.89, 0.32, 1.28); /* 更流暢的動畫 */
            border: 2px solid #FFE082;
            cursor: pointer; /* 可点击状态 */
        }
        
        /* 已簽到樣式 */
        .checkin-counter.checked {
            background-color: #E0E0E0; /* 淺灰色背景 */
            color: #757575; /* 灰色文字 */
            border: 2px solid #BDBDBD;
            cursor: not-allowed; /* 不可點擊狀態 */
        }
        
        /* 簽到倒計時提示 */
        .checkin-timer {
            position: absolute;
            top: calc(13rem * var(--app-scale)); /* 位置在簽到按鈕下方 */
            left: calc(1rem * var(--app-scale));
            font-size: calc(0.8rem * var(--app-scale));
            color: #757575;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .checkin-timer.show {
            opacity: 1;
        }
        
        .checkin-icon {
            margin-right: calc(0.6rem * var(--app-scale));
            font-size: calc(1.2rem * var(--app-scale));
        }
        
        /* 簽到計數動畫 - 更豐富的動畫效果 */
        @keyframes counter-update {
            0% { transform: scale(1); }
            20% { transform: scale(1.4); }
            40% { transform: scale(0.9); }
            60% { transform: scale(1.2); }
            80% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        
        /* 簽到成功後的閃爍效果 */
        @keyframes checkin-success {
            0% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.5); background-color: #FFF8E1; }
            50% { box-shadow: 0 0 20px rgba(255, 193, 7, 0.8); background-color: #FFE082; }
            100% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.5); background-color: #FFF8E1; }
        }
        
        .counter-animation {
            animation: counter-update 0.7s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            color: #FF6B6B;
            font-weight: bold;
        }
        
        .checkin-success {
            animation: checkin-success 1.5s ease-in-out;
        }
        
        /* 日期和天數縮放 */
        .date-display {
            font-size: calc(0.875rem * var(--app-scale));
            margin-top: calc(0.5rem * var(--app-scale));
        }
        
        .day-display {
            font-size: calc(1.25rem * var(--app-scale));
            margin-top: calc(0.25rem * var(--app-scale));
        }
        
        /* 圖片容器縮放 - 优化小屏幕显示 */
        .image-container {
            position: relative;
            width: calc(100% * var(--app-scale));
            max-width: calc(350px * var(--app-scale));
            min-width: 200px; /* 设置最小宽度，防止过度缩小 */
            height: auto;
            aspect-ratio: 1.14 / 1; /* 維持原始的寬高比例 */
            margin: calc(-2rem * var(--app-scale)) auto calc(30px * var(--app-scale)) auto; /* 增加负margin的值，提高图片位置 */
            cursor: pointer;
            transition: transform 0.3s ease;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1; /* 確保圖片在較低層級 */
        }
        
        /* 小屏幕特殊处理 */
        @media (max-height: 600px) {
            .image-container {
                margin-top: -40px; /* 在小屏幕上使用固定的负margin */
            }
        }
        
        /* 響應式調整 - 设置最小宽度 */
        @media (max-width: 640px) {
            .image-container {
                max-width: calc(280px * var(--app-scale));
                min-width: 200px;
            }
        }
        
        @media (max-width: 480px) {
            .image-container {
                max-width: calc(250px * var(--app-scale));
                min-width: 180px;
            }
        }
        
        /* 搖動動畫定義 */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-3px); }
            20%, 40%, 60%, 80% { transform: translateX(3px); }
        }
        
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }
        
        /* 移除hover放大效果 */
        .image-container:active {
            transform: scale(0.98);
        }
        
        .image-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            /* 移除边框效果 */
            padding: 0;
        }
        
        .main-image {
            width: 100%;
            height: 100%;
            object-fit: cover; /* 改為cover以實現剪裁效果 */
            object-position: center; /* 只顯示中間部分 */
            position: absolute;
            transition: opacity 0.3s ease;
            clip-path: inset(20% 0 20% 0); /* 剪裁上下各20% */
        }
        
        .initial-image, .clicked-image, .final-image {
            opacity: 0;
        }
        
        .image-active {
            opacity: 1;
        }
        
        /* 點擊計數提示 - 调整与图片的距离为5rem */
        .click-progress {
            position: absolute;
            bottom: calc(-5rem * var(--app-scale)); /* 修改为5rem距离 */
            left: 0;
            right: 0;
            text-align: center;
            font-weight: bold;
            color: #5D5CDE;
            font-size: calc(18px * var(--app-scale)); /* 縮放字體大小 */
            opacity: 0;
            transition: opacity 0.3s ease;
            font-family: 'Hachi Maru Pop', cursive; /* 添加可愛字體 */
        }
        
        .click-progress.show {
            opacity: 1;
        }
        
        /* 結果容器 */
        .fortune-container {
            min-height: calc(80px * var(--app-scale));
            max-height: calc(150px * var(--app-scale));
            overflow-y: auto;
            border-radius: 12px;
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            transform: translateY(10px);
            opacity: 0;
            padding: calc(0.85rem * var(--app-scale)) !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            margin-bottom: calc(1rem * var(--app-scale));
        }
        
        .fortune-container.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        /* 結果文字 - 桌面版特別處理 */
        .fortune-text {
            font-size: calc(1.3rem * var(--app-scale));
            line-height: calc(1.6 * var(--app-scale));
            font-weight: 500;
            color: #333;
            white-space: normal; /* 確保文字可以換行 */
            word-wrap: break-word; /* 長單詞可以斷行 */
        }
        
        /* 桌面版字體調整 */
        @media (min-width: 768px) {
            .fortune-text {
                font-size: calc(1rem * var(--app-scale));
                line-height: calc(1.3 * var(--app-scale));
            }
        }
        
        /* 倒計時容器 */
        .countdown-container {
            margin-top: calc(0.75rem * var(--app-scale));
            padding-top: calc(0.75rem * var(--app-scale));
            font-size: calc(0.875rem * var(--app-scale));
        }
        
        /* 桌面版調整倒計時顯示 */
        @media (min-width: 768px) {
            .countdown-container {
                font-size: calc(1rem * var(--app-scale));
            }
            
            #countdown-timer {
                font-size: calc(1.05rem * var(--app-scale));
            }
        }
        
        /* 頁腳 */
        .app-footer {
            font-size: calc(0.75rem * var(--app-scale));
            margin-top: calc(0.25rem * var(--app-scale));
        }
        
        /* 加載動畫容器 */
        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 30;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center bg-white text-gray-800">
    <div class="app-container w-full flex flex-col items-center justify-between">
        <!-- 信件箱 - 改名為郵箱 -->
        <div id="mailbox" class="mailbox button-common">
            <span class="mailbox-icon">❤️</span>
            郵箱
        </div>
        
        <!-- 簽到計數器 -->
        <div id="checkin-counter" class="checkin-counter button-common">
            <span class="checkin-icon">🐾</span>
            <span id="checkin-count">0</span> 次簽到
        </div>
        
        <!-- 簽到倒計時提示 -->
        <div id="checkin-timer" class="checkin-timer">
            下次簽到: <span id="next-checkin-time">00:00:00</span>
        </div>
        
        <!-- 郵箱模態窗口 -->
        <div id="mail-modal" class="modal-overlay">
            <div class="modal-container">
                <div class="modal-header">
                    <h2 class="modal-title">貓貓通訊</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <!-- 郵箱列表視圖 -->
                    <div id="mail-list-view" class="mail-view">
                        <ul class="mail-list">
                            <li class="mail-item" data-mail-id="mail-1">
                                <span class="mail-icon">❤️</span>
                                <span class="mail-title">貓貓生日</span>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- 郵箱內容視圖 - 移動返回按鈕到内容后，移除标题 -->
                    <div id="mail-detail-view" class="mail-detail-view hidden">
                        <div id="mail-detail-content" class="mail-content"></div>
                        <button id="back-to-list" class="back-button">
                            <span class="back-button-icon">←</span> 返回
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 隱藏的郵箱內容 -->
        <div id="mail-contents" style="display: none;">
            <div id="mail-1" class="mail-content-data">
親愛的貓貓：

誒，第二次跟貓貓過生日了，雖然我記性不好，但上一年在車車跟貓貓過生日的畫面仍深刻！當時貓貓說沒太期待過生日，我一方面希望貓貓期待（證明貓貓希望得到我的心意），另一方面害怕貓貓期待（因為我覺得準備得不好嗚）TAT

最近很疲憊，東西好像做不完似的，可能因為實際工作時間比之前短了（沒留到10點（X）每當在學校工作許久後才有時間找貓貓，便會覺得愧疚。現在不在一個地方工作，見面的機會少了很多，總覺得不滿足。加上星期六日不是我忙就是你累，有時會暢想，要是平日回家能看到貓貓就好了www不僅僅是我，貓貓現在也工作到很晚！沒資格說我喜歡OT了！我會做著家務等貓貓的（咦

雖然貓貓常常不給親親不給摸摸（肚肚），可我依然愛著你的幼稚你的口不對心。被你推開的時候我會提醒自己別太難過，因為這是你的反射動作。情人節的時候說之後送不同花花給貓貓，像開圖鑑似的。其實這次我本打算做針織玫瑰花，買了材料包，商家聲稱會附上保姆級教學，然而我連影片開頭都看不懂@.@奮戰了一小時仍沒法開始，結果先擱置一邊了。還好可以在這裡添上背景的小黃花，姑且也算花？

呀呀呀，說了很多沒營養的話。先說到這裡，不定期更新:P 貓貓生日快樂！

18/3/2025
            </div>
        </div>
        
        <header class="w-full max-w-xl text-center">
            <h1 class="app-title font-bold text-primary">貓貓專屬迷你占卜</h1>
            <div id="current-datetime" class="date-display font-medium text-gray-700"></div>
            <div id="day-counter" class="day-display font-bold text-gray-700"></div>
        </header>

        <main class="flex-1 w-full max-w-xl flex flex-col items-center justify-center">
            <div class="w-full flex flex-col items-center">
                <div id="image-container" class="image-container">
                    <!-- 圖片包裝器 -->
                    <div class="image-wrapper">
                        <img src="https://i.imgur.com/RdfIav1.png" alt="可愛的貓" id="initial-image" class="main-image initial-image image-active">
                        <img src="https://i.imgur.com/Ff7QTIv.png" alt="可愛的貓點擊效果" id="clicked-image" class="main-image clicked-image">
                        <img src="https://i.imgur.com/dgyoDVN.jpeg" alt="可愛的貓最終圖" id="final-image" class="main-image final-image">
                    </div>
                    
                    <!-- 加載動畫 -->
                    <div id="loading" class="loading">
                        <div class="w-8 h-8 border-3 border-primary-light border-t-transparent rounded-full animate-spin"></div>
                    </div>
                    
                    <!-- 點擊進度提示 -->
                    <div id="click-progress" class="click-progress">再點擊 5 次</div>
                </div>

                <div class="fortune-container w-full bg-white rounded-lg shadow-md text-center" id="fortune-box">
                    <p class="fortune-text font-medium" id="fortune-text"></p>
                    <!-- 倒計時容器 -->
                    <div id="countdown-container" class="countdown-container border-t border-gray-200 text-gray-600 hidden">
                        <p id="countdown-text">還有 <span id="countdown-timer" class="font-bold text-primary">00:00:00</span> 可開始下一次預測</p>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer w-full max-w-xl text-center text-gray-500">
            <p>輕觸圖片，獲得今日的特別鼓勵吧！</p>
        </footer>
    </div>
    
    <!-- 動態調整縮放比例的腳本 -->
    <script>
        // 完全重寫簡單的縮放機制，確保固定的可靠結果
        function updateLayout() {
            const vh = window.innerHeight;
            const vw = window.innerWidth;
            const header = document.querySelector('header');
            const dayCounter = document.getElementById('day-counter');
            const imageContainer = document.getElementById('image-container');
            
            // 確保Day X顯示在圖片之上
            if (dayCounter && imageContainer) {
                dayCounter.style.position = 'relative';
                dayCounter.style.zIndex = '10'; // 確保Day X在圖片之上
            }
            
            // 設置固定的縮放比例，不再動態計算
            let scale = 1.0;
            
            // 桌面設備 - 固定大尺寸
            if (vw >= 1024) {
                // 大型桌面
                scale = 1.4;
                
                // 非常大的寬屏
                if (vw > 1400) {
                    scale = 1.5;
                }
            } 
            else if (vw >= 768) {
                // 平板/小型桌面
                scale = 1.2;
            }
            // 手機設備
            else {
                // 根據手機高度設置合理的縮放
                scale = 1.0;
                if (vh < 700) scale = 0.9;
                if (vh < 600) scale = 0.8;
                if (vh < 500) scale = 0.7;
            }
            
            // 應用縮放值
            document.documentElement.style.setProperty('--app-scale', scale);
            
            console.log(`視窗尺寸: ${vw}x${vh}px, 縮放比例: ${scale}`);
        }
        
        // 頁面載入和調整大小時更新佈局
        window.addEventListener('load', updateLayout);
        window.addEventListener('resize', updateLayout);
        
        // 立即更新一次佈局
        updateLayout();
    </script>

    <script>
        // 簽到計數器 - 管理累計占卜次數
        const CHECKIN_COUNTER_KEY = 'catFortuneCheckinCount';
        const LAST_CHECKIN_DATE_KEY = 'catFortuneLastCheckinDate';
        
        // 創建内存變量存儲簽到數據
        let checkinCount = 0;
        let lastCheckinTime = null; // 上次签到时间
        let checkedInToday = false; // 今天是否已签到
        
        // 加載並顯示累計簽到次數 - 使用内存變量
        function loadCheckinCount() {
            // 更新UI顯示
            document.getElementById('checkin-count').textContent = checkinCount;
            return checkinCount;
        }
        
        // 檢查今天是否已經簽到過
        function hasCheckedInToday() {
            return checkedInToday;
        }
        
        // 获取下次可签到时间（早上7点）
        function getNextCheckinTime() {
            const now = new Date();
            // 明天早上7點
            const tomorrow = new Date(now);
            tomorrow.setDate(now.getDate() + 1);
            tomorrow.setHours(7, 0, 0, 0);
            
            // 如果現在時間還沒到今天早上7點，那麼重置時間是今天早上7點
            if (now.getHours() < 7) {
                tomorrow.setDate(now.getDate());
            }
            
            return tomorrow.getTime() - now.getTime();
        }
        
        // 更新簽到按鈕狀態
        function updateCheckinButtonState() {
            const checkinCounter = document.getElementById('checkin-counter');
            const checkinTimer = document.getElementById('checkin-timer');
            const nextCheckinTime = document.getElementById('next-checkin-time');
            
            if (hasCheckedInToday()) {
                // 已簽到狀態
                checkinCounter.classList.add('checked');
                checkinTimer.classList.add('show');
                
                // 计算并显示下次可签到时间
                const timeToNextCheckin = getNextCheckinTime();
                nextCheckinTime.textContent = formatCountdown(timeToNextCheckin);
            } else {
                // 可簽到狀態
                checkinCounter.classList.remove('checked');
                checkinTimer.classList.remove('show');
            }
        }
        
        // 检查是否可以重置签到状态
        function checkAndResetCheckinState() {
            if (!lastCheckinTime) return;
            
            const now = new Date();
            const lastDate = new Date(lastCheckinTime);
            
            // 获取今天7点的时间
            const todayReset = new Date(now);
            todayReset.setHours(7, 0, 0, 0);
            
            // 如果现在已经过了今天7点，且上次签到是在今天7点之前
            if (now >= todayReset && lastDate < todayReset) {
                checkedInToday = false;
                updateCheckinButtonState();
            }
        }
        
        // 每分钟检查一次是否需要重置签到状态
        setInterval(checkAndResetCheckinState, 60000);
        
        // 增加簽到計數並保存 - 加強動畫效果
        function incrementCheckinCount() {
            // 如果今天已經簽到，不允許再次簽到
            if (hasCheckedInToday()) {
                showAlreadyCheckedInMessage();
                return checkinCount;
            }
            
            // 记录签到信息
            checkedInToday = true;
            lastCheckinTime = new Date().getTime();
            checkinCount += 1;
            
            // 使用更明顯的動畫效果
            const countElement = document.getElementById('checkin-count');
            const counter = document.getElementById('checkin-counter');
            
            // 先移除之前的任何動畫類
            countElement.classList.remove('counter-animation');
            counter.classList.remove('checkin-success');
            counter.classList.remove('animate-pulse');
            
            // 觸發重排以確保動畫效果重新應用
            void counter.offsetWidth;
            
            // 更新UI顯示
            countElement.textContent = checkinCount;
            
            // 添加更多動畫類
            countElement.classList.add('counter-animation');
            counter.classList.add('checkin-success');
            
            // 添加簽到成功文本提示
            const successText = document.createElement('div');
            successText.textContent = '簽到成功！';
            successText.style.position = 'absolute';
            successText.style.top = '-30px';
            successText.style.left = '0';
            successText.style.right = '0';
            successText.style.textAlign = 'center';
            successText.style.color = '#FF6B6B';
            successText.style.fontWeight = 'bold';
            successText.style.fontSize = `${1 * parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--app-scale'))}rem`;
            successText.style.opacity = '0';
            successText.style.transition = 'opacity 0.3s ease-in-out, transform 0.8s ease-out';
            successText.style.transform = 'translateY(0)';
            
            counter.appendChild(successText);
            
            // 顯示文本提示並動畫
            setTimeout(() => {
                successText.style.opacity = '1';
            }, 100);
            
            setTimeout(() => {
                successText.style.transform = 'translateY(-20px)';
            }, 200);
            
            // 動畫結束後移除類和提示
            setTimeout(() => {
                countElement.classList.remove('counter-animation');
                counter.classList.remove('checkin-success');
                successText.style.opacity = '0';
                
                setTimeout(() => {
                    successText.remove();
                    // 更新签到按钮状态
                    updateCheckinButtonState();
                }, 500);
            }, 2000);
            
            console.log('簽到成功！目前累計：', checkinCount);
            
            return checkinCount;
        }
        
        // 显示已经签到过的提示
        function showAlreadyCheckedInMessage() {
            const counter = document.getElementById('checkin-counter');
            const alreadyCheckinText = document.createElement('div');
            alreadyCheckinText.textContent = '今日已簽到！';
            alreadyCheckinText.style.position = 'absolute';
            alreadyCheckinText.style.top = '-30px';
            alreadyCheckinText.style.left = '0';
            alreadyCheckinText.style.right = '0';
            alreadyCheckinText.style.textAlign = 'center';
            alreadyCheckinText.style.color = '#F44336';
            alreadyCheckinText.style.fontWeight = 'bold';
            alreadyCheckinText.style.fontSize = `${1 * parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--app-scale'))}rem`;
            alreadyCheckinText.style.opacity = '0';
            alreadyCheckinText.style.transition = 'opacity 0.3s ease-in-out';
            
            counter.appendChild(alreadyCheckinText);
            
            setTimeout(() => {
                alreadyCheckinText.style.opacity = '1';
            }, 100);
            
            setTimeout(() => {
                alreadyCheckinText.style.opacity = '0';
                setTimeout(() => {
                    alreadyCheckinText.remove();
                }, 500);
            }, 2000);
        }
        
        // 更新签到倒计时
        function updateCheckinCountdown() {
            if (hasCheckedInToday()) {
                const nextCheckinTime = document.getElementById('next-checkin-time');
                const timeToNextCheckin = getNextCheckinTime();
                nextCheckinTime.textContent = formatCountdown(timeToNextCheckin);
                
                // 如果已到重置时间，重置签到状态
                if (timeToNextCheckin <= 0) {
                    checkedInToday = false;
                    updateCheckinButtonState();
                }
            }
        }
        
        // 計算從2024年2月15日到今天的天數
        function calculateDays() {
            const startDate = new Date('2024-02-15');
            const today = new Date();
            
            // 將兩個日期設置為當日的0時0分0秒，以便計算準確的日期差
            startDate.setHours(0, 0, 0, 0);
            today.setHours(0, 0, 0, 0);
            
            // 計算毫秒差異
            const diffTime = Math.abs(today - startDate);
            // 轉換為天數
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            // 更新顯示
            document.getElementById('day-counter').textContent = `Day ${diffDays}`;
        }
        
        // 更新日期時間
        function updateDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            
            // 格式化小時為12小時制
            let hours = now.getHours();
            const ampm = hours >= 12 ? 'pm' : 'am';
            hours = hours % 12;
            hours = hours ? hours : 12; // 0應該顯示為12
            
            // 格式化分鐘
            const minutes = String(now.getMinutes()).padStart(2, '0');
            
            // 依照指定格式: 2025年3月11日 10:48pm
            const formattedDateTime = `${year}年${month}月${day}日 ${hours}:${minutes}${ampm}`;
            
            document.getElementById('current-datetime').textContent = formattedDateTime;
            
            // 同時更新天數計數
            calculateDays();
        }
        
        // 初始化日期時間並每分鐘更新一次
        updateDateTime();
        setInterval(updateDateTime, 60000);

        // 貓咪占卜結果列表
        const encouragements = [
            "別擔心，魚乾總會有的！",
            "窗外的鳥飛快，而你如此優雅地眺望。",
            "舔舔自己的爪子，生活總會再亮晶晶起來！",
            "別害怕黑夜，你有最敏銳的眼睛和最柔軟的心。",
            "就算今天翻倒了水碗，明天依然有清涼的水。",
            "即使世界很大，你的小窩永遠是最溫暖的地方。",
            "哪怕今天曬不到太陽，但太陽總在！",
            "誒！一起去吃甜品好不好！",
            "你的每次蹭蹭，都是別人溫暖的禮物。",
            "每一次的跳躍，都更靠近星星。",
            "我喵故我在。",
            "如果煎八爪魚腳腳，就會傳出香味。",
            "在泥巴裡打滾的除了豬豬，還有近豬者豬的貓貓。",
            "沒有什麼是不可能的，除了一天不吃罐罐。",
            "貓貓不跑步也許是好的。跑太快就變豹豹了。",
            "身為一隻優秀的貓貓應該要懂得攀岩。誒貓貓有興趣一起去玩嗎？",
            "貓貓跟士多啤梨的共同點就是……都是我愛的！",
            "閉眼十秒再睜眼，會有好運氣哦。",
            "好想和貓貓去旅行:3:3:3",
            "路上的貓不都是迷路了，有些只是自由地散步。",
            "世界上最讓貓舒服的事，就是曬太陽與被愛。",
            "一隻喵的價值，不在於牠抓了多少老鼠，而在於牠如何享受生活。",
            "別問貓咪能為你做什麼，問問你能為貓咪做什麼。",
            "貓咪生來就是要躺在陽光下，而不是去追逐激光點。",
            "抓不住的毛線球，總是最有趣的。",
            "給貓咪一個窗台，牠能看透整個宇宙。",
            "別人看見貓咪在睡覺，但牠的夢裡是廣闊的草原。",
            "沒有什麼比貓咪在陽光下打滾更接近天堂。",
            "把貓咪和多士綁在一起就變成永動機！（咦？）",
            "貓咪無需解釋，因為牠的存在就是最好的理由。",
            "貓咪不會嫌魚乾多！",
            "不惹睡覺的貓！",
            "天上的飛鳥不為吃喝憂慮，貓咪也不為魚乾憂愁。",
            "嘿，最乖巧的貓咪也曾推倒杯子。",
            "沒有什麼是一隻貓咪不能克服的，如果有，那就出動兩隻貓咪！",
            "三隻大橘貓，勝過一隻緬因貓。",
            "吾日三省喵身：跟豬豬說早安乎？吃飽乎？早睡乎？",
            "歲寒，然後知貓貓之胖胖也。",
            "不經一番寒徹骨，怎得感冒傷風咳。（咦？）",
            "世上無難事，有的話就不做了！",
            "明日復明日，明日何其多！今天先睡覺，萬事明日磨。",
            "風聲雨聲讀書聲，zzzzzzz",
            "龍床不如紙箱。",
            "從前有一隻貓說：「喵~」",
            "台上一分鐘，台下六十秒。",
            "橘貓會舔光每個罐罐。",
            "塞翁失馬，跟貓咪沒有關係。",
            "主人不努力，貓貓徒傷悲。",
            "有智慧的貓貓不追求把手手放在上層。",
            "深吸一口貓。",
            "成功屬於那些努力不懈的貓，因為它們總能跳到被禁止的桌子上。",
            "不要為打翻的牛奶哭泣，因為貓已經在舔了。",
            "人生苦短，及時養貓。",
            "愛一隻貓就要接受它半夜踩你的臉。",
            "不要和貓爭沙發，因為你會輸，貓卻很開心！",
            "上天關閉了一扇門，貓貓會幫你打開衣櫃！",
            "時間會治癒一切，除了被貓貓推倒的東西。",
            "心有多大，貓的領地就有多大。",
            "貓就是在你趕文件時跳上鍵盤的傢伙。",
            "隔壁家的罐罐好像更好吃！",
            "己所不欲，貓照樣會做給你看！",
            "貓貓所見略同----所有箱子都是牠們的。",
            "一個人可以被毀滅，但貓不會屈服----除了討要罐罐的時候。",
            "機會是留給……貓從不準備，它會直接跳上去！",
            "給貓一個紙箱，牠可以環遊世界。",
            "你最可愛muah /////",
            "貓睡成一個可愛的小月亮，如此安穩。",
            "喵喵喵？喵！"
        ];

        // 圖片和圖片URL設定
        const INITIAL_IMAGE = "https://i.imgur.com/RdfIav1.png";
        const CLICKED_IMAGE = "https://i.imgur.com/Ff7QTIv.png";
        const FINAL_IMAGE = "https://i.imgur.com/dgyoDVN.jpeg";
        
        // 儲存鍵名
        const FORTUNE_STORAGE_KEY = 'dailyFortuneData';
        
        // 圖片點擊事件
        let isAnimating = false;
        let clickCount = 0;
        const requiredClicks = 5;
        let canPredict = true; // 是否可以進行占卜
        let lastPrediction = null; // 最後一次占卜的結果
        let lastPredictionTime = null; // 最後一次占卜的時間
        
        // 獲取當前時間到下一個早上7點的毫秒數
        function getTimeToNextReset() {
            const now = new Date();
            // 明天早上7點
            const tomorrow = new Date(now);
            tomorrow.setDate(now.getDate() + 1);
            tomorrow.setHours(7, 0, 0, 0);
            
            // 如果現在時間還沒到今天早上7點，那麼重置時間是今天早上7點
            if (now.getHours() < 7) {
                tomorrow.setDate(now.getDate());
            }
            
            return tomorrow.getTime() - now.getTime();
        }
        
        // 格式化倒計時時間為 HH:MM:SS 格式
        function formatCountdown(milliseconds) {
            // 轉換毫秒到小時、分鐘和秒
            let totalSeconds = Math.floor(milliseconds / 1000);
            let hours = Math.floor(totalSeconds / 3600);
            let minutes = Math.floor((totalSeconds % 3600) / 60);
            let seconds = totalSeconds % 60;
            
            // 補零
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        // 更新倒計時顯示
        function updateCountdown() {
            const countdownContainer = document.getElementById('countdown-container');
            const countdownTimer = document.getElementById('countdown-timer');
            
            // 如果没有上次的占卜時間，隱藏倒計時
            if (!lastPredictionTime) {
                countdownContainer.classList.add('hidden');
                return;
            }
            
            const timeToNextReset = getTimeToNextReset();
            countdownTimer.textContent = formatCountdown(timeToNextReset);
            
            // 如果倒計時結束，恢復占卜功能
            if (timeToNextReset <= 0) {
                resetFortuneState();
            }
        }
        
        // 获取圖片元素
        const initialImage = document.getElementById('initial-image');
        const clickedImage = document.getElementById('clicked-image');
        const finalImage = document.getElementById('final-image');
        const fortuneBox = document.getElementById('fortune-box');
        const fortuneText = document.getElementById('fortune-text');
        const loading = document.getElementById('loading');
        const clickProgress = document.getElementById('click-progress');
        const countdownContainer = document.getElementById('countdown-container');
        
        // 重置占卜狀態
        function resetFortuneState() {
            canPredict = true;
            lastPrediction = null;
            lastPredictionTime = null;
            clickCount = 0;
            
            // 重置UI
            showImage(initialImage);
            fortuneBox.classList.remove('show');
            countdownContainer.classList.add('hidden');
            clickProgress.textContent = `再按 ${requiredClicks} 次`;
            clickProgress.classList.add('show');
            
            // 清除本地儲存
            try {
                localStorage.removeItem(FORTUNE_STORAGE_KEY);
            } catch (e) {
                // 忽略錯誤
            }
        }
        
        // 保存占卜結果到本地儲存
        function saveFortuneState(prediction) {
            const now = new Date();
            lastPrediction = prediction;
            lastPredictionTime = now.getTime();
            
            try {
                // 使用 sessionStorage 代替 localStorage，这样在页面刷新后仍可用，但在浏览器关闭后会清除
                sessionStorage.setItem(FORTUNE_STORAGE_KEY, JSON.stringify({
                    prediction: lastPrediction,
                    time: lastPredictionTime
                }));
                
                // 尝试使用localStorage作为备份
                try {
                    localStorage.setItem(FORTUNE_STORAGE_KEY, JSON.stringify({
                        prediction: lastPrediction,
                        time: lastPredictionTime
                    }));
                } catch (storageErr) {
                    console.log('localStorage保存失败，但已保存到sessionStorage:', storageErr);
                }
                
                // 確保在存儲占卜結果後再增加簽到次數，但僅在今日未簽到的情況下
                setTimeout(() => {
                    // 檢查每日簽到上限
                    if (!hasCheckedInToday()) {
                        // 增加簽到次數
                        incrementCheckinCount();
                        
                        // 保存今天已簽到的紀錄
                        try {
                            localStorage.setItem(LAST_CHECKIN_DATE_KEY, now.getTime().toString());
                        } catch (e) {
                            sessionStorage.setItem(LAST_CHECKIN_DATE_KEY, now.getTime().toString());
                        }
                    }
                }, 100);
            } catch (e) {
                console.log('保存占卜結果失敗:', e);
            }
            
            // 更新UI
            canPredict = false;
            fortuneText.textContent = lastPrediction;
            fortuneBox.classList.add('show');
            countdownContainer.classList.remove('hidden');
            clickProgress.classList.remove('show');
        }
        
        // 創建内存變量存儲狀態 - 不使用localStorage
        let memoryStorage = {};
        
        // 載入占卜狀態 - 使用内存变量而非localStorage
        function loadFortuneState() {
            try {
                let savedData = memoryStorage[FORTUNE_STORAGE_KEY];
                
                if (savedData) {
                    const { prediction, time } = savedData;
                    const savedTime = new Date(time);
                    const now = new Date();
                    
                    // 檢查是否是同一個"重置周期"
                    // 計算最後一次占卜時間到當前的最近一個7點是否已經過去
                    let resetTime = new Date(savedTime);
                    // 如果占卜時間是在7點之前，那麼重置時間是當天早上7點
                    if (savedTime.getHours() < 7) {
                        resetTime.setHours(7, 0, 0, 0);
                    } 
                    // 否則重置時間是隔天早上7點
                    else {
                        resetTime.setDate(resetTime.getDate() + 1);
                        resetTime.setHours(7, 0, 0, 0);
                    }
                    
                    // 如果現在時間還沒到重置時間，恢復上次占卜狀態
                    if (now < resetTime) {
                        lastPrediction = prediction;
                        lastPredictionTime = time;
                        canPredict = false;
                        
                        // 更新UI
                        showImage(finalImage);
                        fortuneText.textContent = lastPrediction;
                        fortuneBox.classList.add('show');
                        countdownContainer.classList.remove('hidden');
                        clickProgress.classList.remove('show');
                    } else {
                        // 已過重置時間，重置狀態
                        resetFortuneState();
                    }
                }
            } catch (e) {
                console.error('載入占卜狀態失敗:', e);
                // 出錯時重置
                resetFortuneState();
            }
        }
        
        // 預加載圖片以確保平滑過渡
        function preloadImages() {
            const images = [
                "https://i.imgur.com/RdfIav1.png",
                "https://i.imgur.com/Ff7QTIv.png",
                "https://i.imgur.com/dgyoDVN.jpeg"
            ];
            
            images.forEach(src => {
                const img = new Image();
                img.src = src;
            });
        }
        
        // 切換活動圖片
        function showImage(imageToShow) {
            // 隱藏所有圖片
            initialImage.classList.remove('image-active');
            clickedImage.classList.remove('image-active');
            finalImage.classList.remove('image-active');
            
            // 顯示指定的圖片
            imageToShow.classList.add('image-active');
        }
        
        // 初始化郵箱箱功能
        function initMailbox() {
            const mailbox = document.getElementById('mailbox');
            const mailModal = document.getElementById('mail-modal');
            const closeBtn = mailModal.querySelector('.modal-close');
            const mailItems = mailModal.querySelectorAll('.mail-item');
            const mailListView = document.getElementById('mail-list-view');
            const mailDetailView = document.getElementById('mail-detail-view');
            const backToListBtn = document.getElementById('back-to-list');
            const mailDetailTitle = document.getElementById('mail-detail-title');
            const mailDetailContent = document.getElementById('mail-detail-content');
            const mailContentsContainer = document.getElementById('mail-contents');
            
            // 打開郵箱箱 - 每次打開都顯示列表視圖
            mailbox.addEventListener('click', () => {
                // 重置視圖
                mailListView.classList.remove('hidden');
                mailDetailView.classList.add('hidden');
                
                // 顯示模態窗口
                mailModal.classList.add('active');
            });
            
            // 關閉郵箱箱
            closeBtn.addEventListener('click', () => {
                mailModal.classList.remove('active');
                
                // 延遲後重置視圖，以便下次打開顯示列表
                setTimeout(() => {
                    mailListView.classList.remove('hidden');
                    mailDetailView.classList.add('hidden');
                }, 300);
            });
            
            // 點擊郵箱列表項目
            mailItems.forEach(item => {
                item.addEventListener('click', () => {
                    // 獲取郵箱數據
                    const mailId = item.getAttribute('data-mail-id');
                    const mailContentElement = mailContentsContainer.querySelector(`#${mailId}`);
                    const mailContent = mailContentElement ? mailContentElement.textContent : '無內容';
                    
                    // 填充郵箱詳情視圖
                    mailDetailContent.textContent = mailContent;
                    
                    // 顯示詳情視圖，隱藏列表視圖
                    mailListView.classList.add('hidden');
                    mailDetailView.classList.remove('hidden');
                });
            });
            
            // 返回按鈕點擊事件
            backToListBtn.addEventListener('click', () => {
                // 顯示列表視圖，隱藏詳情視圖
                mailListView.classList.remove('hidden');
                mailDetailView.classList.add('hidden');
            });
            
            // 點擊模態窗口背景關閉窗口
            mailModal.addEventListener('click', (e) => {
                if (e.target === mailModal) {
                    mailModal.classList.remove('active');
                    
                    // 延遲後重置視圖
                    setTimeout(() => {
                        mailListView.classList.remove('hidden');
                        mailDetailView.classList.add('hidden');
                    }, 300);
                }
            });
            
            // 添加ESC鍵關閉功能
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && mailModal.classList.contains('active')) {
                    mailModal.classList.remove('active');
                    
                    // 延遲後重置視圖
                    setTimeout(() => {
                        mailListView.classList.remove('hidden');
                        mailDetailView.classList.add('hidden');
                    }, 300);
                }
            });
        }
        
        // 初始化
        function init() {
            // 載入保存的狀態
            loadFortuneState();
            
            // 載入打卡計數
            loadCheckinCount();
            
            // 更新签到按钮状态
            updateCheckinButtonState();
            
            // 如果可以占卜，顯示點擊提示
            if (canPredict) {
                clickProgress.textContent = `再按 ${requiredClicks} 次`;
                clickProgress.classList.add('show');
            }
            
            // 預加載圖片
            preloadImages();
            
            // 設置倒計時定時器
            setInterval(updateCountdown, 1000);
            
            // 设置签到倒计时定时器
            setInterval(updateCheckinCountdown, 1000);
            
            // 初始化郵箱箱功能
            initMailbox();
            
            // 簽到按鈕點擊事件
            const checkinCounter = document.getElementById('checkin-counter');
            checkinCounter.addEventListener('click', function() {
                incrementCheckinCount();
            });
        }
        
        // 頁面載入時初始化
        init();
        
        // 圖片點擊事件
        document.getElementById('image-container').addEventListener('click', async function() {
            // 如果不能占卜或动畫正在進行，返回
            if (!canPredict || isAnimating) return;
            
            // 更新點擊計數
            clickCount++;
            
            // 切換到點擊圖片
            showImage(clickedImage);
            
            // 將圖片包裝器添加搖動動畫
            const imageWrapper = document.querySelector('.image-wrapper');
            imageWrapper.classList.add('shake');
            
            // 移除搖動動畫
            setTimeout(() => {
                imageWrapper.classList.remove('shake');
            }, 500);
            
            // 0.5秒後恢復原圖片（如果還沒達到5次點擊）
            setTimeout(() => {
                // 如果還沒有完成所有點擊或者正在進行占卜，恢復原來的圖片
                if (clickCount < requiredClicks && !isAnimating) {
                    showImage(initialImage);
                }
            }, 500);
            
            // 檢查是否達到所需點擊次數
            if (clickCount < requiredClicks) {
                // 更新提示文字
                clickProgress.textContent = `再按 ${requiredClicks - clickCount} 次`;
                return;
            }
            
            // 達到所需點擊次數，執行占卜
            isAnimating = true;
            
            // 隱藏點擊提示
            clickProgress.classList.remove('show');
            
            // 切換到最終圖片
            showImage(finalImage);
            
            // 隱藏上一次的結果
            fortuneBox.classList.remove('show');
            
            // 顯示加載動畫
            loading.style.display = 'block';
            
            // 隨機選擇一個鼓勵句子
            const randomIndex = Math.floor(Math.random() * encouragements.length);
            const selectedEncouragement = encouragements[randomIndex];
            
            // 模擬思考時間
            await new Promise(resolve => setTimeout(resolve, 1500));
            
            // 隱藏加載動畫
            loading.style.display = 'none';
            
            // 保存並顯示占卜結果
            saveFortuneState(selectedEncouragement);
            
            // 設置動畫結束
            isAnimating = false;
        });
    </script>


</body></html>

